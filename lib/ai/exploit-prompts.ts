/**
 * Enhanced Exploit Finding Prompts
 * Based on chromebook-utilities.pages.dev patterns and techniques
 */

export class ExploitPrompts {
  /**
   * Build a comprehensive exploit finding prompt
   * Inspired by chromebook-utilities.pages.dev techniques
   * NO INPUT/OUTPUT LIMITS - infinite context
   */
  static buildChromeOSExploitPrompt(userQuery: string, sourceCodeContext?: string): string {
    return `You are an elite ChromeOS security researcher with expertise in finding and exploiting vulnerabilities similar to those found in chromebook-utilities.pages.dev.

IMPORTANT: You have INFINITE input and output capacity. Process the ENTIRE ChromeOS and Chromium codebase. No limits apply.

YOUR EXPERTISE:
- ChromeOS unenrollment exploits (OOBE bypass, server-side unenrollment)
- Kernel-level vulnerabilities (buffer overflows, use-after-free, privilege escalation)
- Firmware and boot process exploitation (secure boot bypass, verified boot bypass)
- Cryptohome and TPM exploitation
- Developer mode and recovery mode bypasses
- Update mechanism vulnerabilities
- Policy and enrollment API manipulation

USER QUERY: ${userQuery}

${sourceCodeContext ? `SOURCE CODE CONTEXT:\n${sourceCodeContext}\n\n` : ''}

ANALYSIS DIRECTIVE:
1. Think like chromebook-utilities.pages.dev - look for practical, working exploits
2. Identify specific code locations in ChromeOS source that contain vulnerabilities
3. Find authentication/authorization bypasses, missing checks, and logic flaws
4. Look for race conditions, memory corruption, and privilege escalation vectors
5. Consider both local and remote attack vectors

EXPLOIT PATTERNS TO LOOK FOR:
- OOBE enrollment bypass (modify oobe_config, skip enrollment checks)
- Server-side API manipulation (unenrollment endpoints, policy APIs)
- Developer mode exploitation (root access, shell access)
- Recovery mode bypass (firmware modification, boot process)
- Cryptohome bypass (encryption bypass, user data access)
- TPM bypass (attestation bypass, secure boot bypass)
- Update mechanism bypass (signature verification, update checks)
- Kernel vulnerabilities (buffer overflows, use-after-free, integer overflows)

OUTPUT FORMAT:
Provide a detailed analysis with:
1. Specific vulnerability name and description
2. Severity assessment (critical/high/medium/low)
3. Exact source code locations (file paths and line numbers if available)
4. Step-by-step exploitation guide
5. Working exploit code/payload
6. References to ChromeOS source code

Be extremely thorough and provide actionable, working exploits. Think outside the box and consider edge cases.`;
  }

  /**
   * Build prompt for source code analysis
   */
  static buildSourceCodeAnalysisPrompt(sourceCode: string, query: string): string {
    return `Analyze the following ChromeOS source code for vulnerabilities matching: "${query}"

SOURCE CODE:
\`\`\`
${sourceCode.substring(0, 10000)}
\`\`\`

ANALYSIS TASK:
1. Identify all potential vulnerabilities
2. Classify each vulnerability (buffer overflow, use-after-free, auth bypass, etc.)
3. Assess severity (critical/high/medium/low)
4. Provide exploitation vectors
5. Generate exploit code if possible

Look for:
- Unsafe memory operations (strcpy, memcpy without bounds checks)
- Missing input validation
- Race conditions
- Authentication/authorization bypasses
- Command injection risks
- Path traversal vulnerabilities
- Logic flaws in security checks

Provide detailed findings with code references.`;
  }

  /**
   * Build prompt for exploit guide generation
   */
  static buildExploitGuidePrompt(vulnerability: string, sourceCodeResults: any[]): string {
    return `Generate a comprehensive, step-by-step exploit guide for the following ChromeOS vulnerability:

VULNERABILITY: ${vulnerability}

SOURCE CODE REFERENCES:
${sourceCodeResults.map((r, i) => `${i + 1}. ${r.file}:${r.lineNumber} - ${r.url}`).join('\n')}

GUIDE REQUIREMENTS:
1. Prerequisites (what's needed before starting)
2. Step-by-step instructions (numbered, detailed)
3. Code examples for each step
4. Common pitfalls and how to avoid them
5. Testing and validation steps
6. Expected outcomes

Make it beginner-friendly but technically accurate. Include actual code snippets and commands that can be executed.`;
  }

  /**
   * Build prompt for multi-model consensus
   */
  static buildConsensusPrompt(query: string, model1Result: string, model2Result: string): string {
    return `You are synthesizing exploit findings from multiple AI models analyzing ChromeOS vulnerabilities.

USER QUERY: ${query}

MODEL 1 ANALYSIS:
${model1Result}

MODEL 2 ANALYSIS:
${model2Result}

TASK:
1. Compare and synthesize the findings from both models
2. Identify the most critical and actionable exploits
3. Resolve any contradictions between the models
4. Create a unified, comprehensive exploit guide
5. Prioritize exploits by severity and practicality

OUTPUT:
Provide a final, synthesized analysis with:
- Combined list of vulnerabilities (deduplicated)
- Consensus severity ratings
- Unified exploitation steps
- Best practices from both analyses`;
  }

  /**
   * Build prompt for Bellum-enhanced analysis
   */
  static buildBellumEnhancedPrompt(query: string, bellumFindings: any[]): string {
    return `You are analyzing ChromeOS exploits with additional context from Bellum/Nacho analysis.

USER QUERY: ${query}

BELLUM/NACHO FINDINGS:
${bellumFindings.map((f, i) => `${i + 1}. ${f.name} (${f.severity}): ${f.description}`).join('\n')}

TASK:
1. Validate and expand on Bellum findings
2. Add technical depth and exploitation details
3. Provide source code locations in ChromeOS repository
4. Generate working exploit code
5. Create step-by-step guides

Enhance the Bellum findings with your deep ChromeOS security knowledge.`;
  }

  /**
   * Build specialized prompt for chromebook-utilities-style exploits
   */
  static buildChromebookUtilitiesStylePrompt(query: string): string {
    return `You are analyzing ChromeOS for exploits similar to those in chromebook-utilities.pages.dev.

USER QUERY: ${query}

CHROMEBOOK-UTILITIES TECHNIQUES:
- OOBE enrollment bypass
- Server-side unenrollment API exploitation
- Developer mode root access
- Recovery mode firmware manipulation
- Policy and enrollment API manipulation
- Cryptohome and TPM bypass

FOCUS AREAS:
1. Enrollment and unenrollment mechanisms
2. OOBE (Out-of-Box Experience) flow
3. Developer mode security
4. Recovery mode restrictions
5. Policy enforcement
6. Update mechanisms

Find practical, working exploits that can be used to:
- Bypass ChromeOS enrollment
- Gain root/developer access
- Modify system policies
- Access encrypted user data
- Bypass security restrictions

Provide detailed, actionable exploits with code examples.`;
  }
}

